{"version":3,"sources":["../src/main.ts"],"sourcesContent":["import { dirname, join } from \"node:path\"\nimport { fileURLToPath } from \"node:url\"\nimport autoLoad from \"@fastify/autoload\"\nimport cors from \"@fastify/cors\"\nimport fastifyJwt from \"@fastify/jwt\"\nimport fastifySensible from \"@fastify/sensible\"\nimport fastifySwagger from \"@fastify/swagger\"\nimport fastifySwaggerUi from \"@fastify/swagger-ui\"\nimport fastify from \"fastify\"\nimport {\n\tjsonSchemaTransform,\n\tserializerCompiler,\n\tvalidatorCompiler\n} from \"fastify-type-provider-zod\"\nimport { DateTime } from \"luxon\"\nimport type { RepositoryFactory } from \"./types/repsoitory-factory.type.js\"\nimport type { HttpExceptionResponse } from \"./types/result.type.js\"\n\ndeclare module \"fastify\" {\n\tinterface FastifyInstance {\n\t\tresolveRepository: <R>(repo: RepositoryFactory<R>) => R\n\t}\n}\n\ndeclare module \"@fastify/jwt\" {\n\tinterface FastifyJWT {\n\t\tpayload: {\n\t\t\tid: number\n\t\t}\n\t}\n}\n\nfunction main() {\n\tconst __filename = fileURLToPath(import.meta.url)\n\tconst __dirname = dirname(__filename)\n\n\tfastify()\n\t\t.setValidatorCompiler(validatorCompiler)\n\t\t.setSerializerCompiler(serializerCompiler)\n\t\t.setErrorHandler((error, request, reply) => {\n\t\t\tif (error.statusCode) return reply.send(error)\n\n\t\t\tconsole.error({\n\t\t\t\ttimestamp: DateTime.now().toISO(),\n\t\t\t\tendpoint: request.url,\n\t\t\t\tmethod: request.method,\n\t\t\t\tmessage: error.message,\n\t\t\t\toriginalError: error\n\t\t\t})\n\n\t\t\t// biome-ignore lint/suspicious/noExplicitAny:\n\t\t\tif ((error as any).intoException) {\n\t\t\t\t// biome-ignore lint/suspicious/noExplicitAny:\n\t\t\t\tconst response = (error as any).intoException() as HttpExceptionResponse\n\t\t\t\treply.statusCode = response.code\n\t\t\t\treturn reply.send(response)\n\t\t\t}\n\n\t\t\treturn reply.internalServerError()\n\t\t})\n\t\t.register(cors)\n\t\t.register(fastifySensible)\n\t\t.register(fastifyJwt, {\n\t\t\tsecret: \"ACCESS_TOKEN_SECRET\"\n\t\t})\n\t\t.register(fastifySwagger, {\n\t\t\topenapi: {\n\t\t\t\tinfo: {\n\t\t\t\t\ttitle: \"FEFT\",\n\t\t\t\t\tversion: \"1.0.0\"\n\t\t\t\t},\n\t\t\t\tservers: []\n\t\t\t},\n\t\t\ttransform: jsonSchemaTransform\n\t\t})\n\t\t.register(fastifySwaggerUi, {\n\t\t\troutePrefix: \"/docs\"\n\t\t})\n\t\t.register(autoLoad, {\n\t\t\tdir: join(__dirname, \"plugins\"),\n\t\t\tmatchFilter: path => path.startsWith(\"/_\"),\n\t\t\tencapsulate: false\n\t\t})\n\t\t.register(autoLoad, {\n\t\t\tdir: join(__dirname, \"routes\"),\n\t\t\tmatchFilter: path => path.endsWith(\"handler.js\")\n\t\t})\n\t\t.listen({ port: 9098 }, (err, address) => {\n\t\t\tif (err) {\n\t\t\t\tconsole.error(err)\n\t\t\t\tprocess.exit(1)\n\t\t\t} else {\n\t\t\t\tconsole.log(`ðŸ¦€ server is listening at ${address}`)\n\t\t\t}\n\t\t})\n}\n\nmain()\n"],"names":["dirname","join","fileURLToPath","autoLoad","cors","fastifyJwt","fastifySensible","fastifySwagger","fastifySwaggerUi","fastify","jsonSchemaTransform","serializerCompiler","validatorCompiler","DateTime","main","__filename","url","__dirname","setValidatorCompiler","setSerializerCompiler","setErrorHandler","error","request","reply","statusCode","send","console","timestamp","now","toISO","endpoint","method","message","originalError","intoException","response","code","internalServerError","register","secret","openapi","info","title","version","servers","transform","routePrefix","dir","matchFilter","path","startsWith","encapsulate","endsWith","listen","port","err","address","process","exit","log"],"mappings":"AAAA,SAASA,OAAO,EAAEC,IAAI,QAAQ,YAAW;AACzC,SAASC,aAAa,QAAQ,WAAU;AACxC,OAAOC,cAAc,oBAAmB;AACxC,OAAOC,UAAU,gBAAe;AAChC,OAAOC,gBAAgB,eAAc;AACrC,OAAOC,qBAAqB,oBAAmB;AAC/C,OAAOC,oBAAoB,mBAAkB;AAC7C,OAAOC,sBAAsB,sBAAqB;AAClD,OAAOC,aAAa,UAAS;AAC7B,SACCC,mBAAmB,EACnBC,kBAAkB,EAClBC,iBAAiB,QACX,4BAA2B;AAClC,SAASC,QAAQ,QAAQ,QAAO;AAkBhC,SAASC;IACR,MAAMC,aAAab,cAAc,YAAYc,GAAG;IAChD,MAAMC,YAAYjB,QAAQe;IAE1BN,UACES,oBAAoB,CAACN,mBACrBO,qBAAqB,CAACR,oBACtBS,eAAe,CAAC,CAACC,OAAOC,SAASC;QACjC,IAAIF,MAAMG,UAAU,EAAE,OAAOD,MAAME,IAAI,CAACJ;QAExCK,QAAQL,KAAK,CAAC;YACbM,WAAWd,SAASe,GAAG,GAAGC,KAAK;YAC/BC,UAAUR,QAAQN,GAAG;YACrBe,QAAQT,QAAQS,MAAM;YACtBC,SAASX,MAAMW,OAAO;YACtBC,eAAeZ;QAChB;QAEA,8CAA8C;QAC9C,IAAI,AAACA,MAAca,aAAa,EAAE;YACjC,8CAA8C;YAC9C,MAAMC,WAAW,AAACd,MAAca,aAAa;YAC7CX,MAAMC,UAAU,GAAGW,SAASC,IAAI;YAChC,OAAOb,MAAME,IAAI,CAACU;QACnB;QAEA,OAAOZ,MAAMc,mBAAmB;IACjC,GACCC,QAAQ,CAAClC,MACTkC,QAAQ,CAAChC,iBACTgC,QAAQ,CAACjC,YAAY;QACrBkC,QAAQ;IACT,GACCD,QAAQ,CAAC/B,gBAAgB;QACzBiC,SAAS;YACRC,MAAM;gBACLC,OAAO;gBACPC,SAAS;YACV;YACAC,SAAS,EAAE;QACZ;QACAC,WAAWnC;IACZ,GACC4B,QAAQ,CAAC9B,kBAAkB;QAC3BsC,aAAa;IACd,GACCR,QAAQ,CAACnC,UAAU;QACnB4C,KAAK9C,KAAKgB,WAAW;QACrB+B,aAAaC,CAAAA,OAAQA,KAAKC,UAAU,CAAC;QACrCC,aAAa;IACd,GACCb,QAAQ,CAACnC,UAAU;QACnB4C,KAAK9C,KAAKgB,WAAW;QACrB+B,aAAaC,CAAAA,OAAQA,KAAKG,QAAQ,CAAC;IACpC,GACCC,MAAM,CAAC;QAAEC,MAAM;IAAK,GAAG,CAACC,KAAKC;QAC7B,IAAID,KAAK;YACR7B,QAAQL,KAAK,CAACkC;YACdE,QAAQC,IAAI,CAAC;QACd,OAAO;YACNhC,QAAQiC,GAAG,CAAC,CAAC,0BAA0B,EAAEH,SAAS;QACnD;IACD;AACF;AAEA1C"}